<%-include('../partials/header.ejs')-%>
<link rel="stylesheet" href="/filepond/dist/filepond.css">
<link rel="stylesheet" href="/filepond-plugin-media-preview/dist/filepond-plugin-media-preview.css">
<link rel="stylesheet" href="/filepond-plugin-image-edit/dist/filepond-plugin-image-edit.css">
<link rel="stylesheet" href="/filepond-plugin-image-preview/dist/filepond-plugin-image-preview.css">
<!-- video -->
<link rel="stylesheet" href="/filepond-plugin-video-preview/dist/filepond-plugin-video-preview.css">
<div class="flex justify-between p-3">
    <div class="flex items-center">
        <a class="hover:bg-slate-200 rounded-full p-2 ml-2" href="/">
            <svg fill="#000000" width="30px" height="30px" viewBox="0 0 32 32"
                style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;" version="1.1"
                xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:serif="http://www.serif.com/"
                xmlns:xlink="http://www.w3.org/1999/xlink">
                <path
                    d="M25.468,14.508l-20.967,-0.008c-0.828,-0 -1.501,0.672 -1.501,1.499c-0,0.828 0.672,1.501 1.499,1.501l21.125,0.009c-0.107,0.159 -0.234,0.306 -0.377,0.439c-3.787,3.502 -9.68,8.951 -9.68,8.951c-0.608,0.562 -0.645,1.511 -0.083,2.119c0.562,0.608 1.512,0.645 2.12,0.083c-0,0 5.892,-5.448 9.68,-8.95c1.112,-1.029 1.751,-2.47 1.766,-3.985c0.014,-1.515 -0.596,-2.968 -1.688,-4.018l-9.591,-9.221c-0.596,-0.574 -1.547,-0.556 -2.121,0.041c-0.573,0.597 -0.555,1.547 0.042,2.121l9.591,9.221c0.065,0.063 0.127,0.129 0.185,0.198Z" />
                <g id="Icon" />
            </svg>
        </a>
        <h1>منشور <%=post.userId.name%></h1>
    </div>
</div>
<div class="container-post border-t-2 border-b-2 p-3">
    <div class="post-profile flex justify-between">
        <a href="/user/about/<%=post.userId._id%>" target="_blank" class="profile-img flex items-center cursor-pointer">
            <div class="ml-2">
                <img class="h-14 w-14 rounded-full border-2 object-cover"
                    src="<%=post.userId.avatar.replace('uploads','')%>" alt="logo">
            </div>
            <div>
                <h1><%= post.userId.name%></h1>
            </div>
        </a>
    </div>
    <div class="post-text">
        <p><%=post.content%></p>
    </div>
    <div class="post-audio flex flex-wrap gap-3">
        <%post.files.forEach((file)=>{%>
        <%if(file.match(imageExtensions)){%>
        <img class="rounded-md pt-1" src="<%=file.replace('uploads','')%>" alt="img">
        <%}else{%>
        <video class="rounded-md pt-1" controls>
            <source src="<%=file.replace('uploads','')%>" type="video/mp4">
            <source src="<%=file.replace('uploads','')%>" type="video/ogg">
            متصفحك لا يدعم تشغيل الفيديو.
        </video>
        <%}%>
        <%})%>
    </div>
    <div class="flex pt-4">
        <%if(post.likes.length > 0){%>
            <form action="/post/like/users" method="post">
                <input type="hidden" name="postId" value="<%=post._id%>">
                <button class="text-center">
                    <span class="likePost">
                        <%=post.likes.length%>
                        <%=post.lastLike._id == locals.user.id? 'انت':post.lastLike.name%> و اخرون</span>
                </button>
            </form>
        <%}%>
    </div>
    <div class="flex justify-between p-4 pt-0">
        <div>
                <button onclick="addLike(this,'<%=encodeURIComponent(post._id)%>')">
                    <svg width="40px" height="40px" viewBox="0 0 24 24"
                        fill="<%=post.likes.includes(locals.user.id)? '#000000':'none'%>" xmlns="http://www.w3.org/2000/svg">
                        <path
                            d="M7.47998 18.35L10.58 20.75C10.98 21.15 11.88 21.35 12.48 21.35H16.28C17.48 21.35 18.78 20.45 19.08 19.25L21.48 11.95C21.98 10.55 21.08 9.34997 19.58 9.34997H15.58C14.98 9.34997 14.48 8.84997 14.58 8.14997L15.08 4.94997C15.28 4.04997 14.68 3.04997 13.78 2.74997C12.98 2.44997 11.98 2.84997 11.58 3.44997L7.47998 9.54997"
                            stroke="#292D32" stroke-width="1.5" stroke-miterlimit="10" />
                        <path
                            d="M2.38 18.35V8.55002C2.38 7.15002 2.98 6.65002 4.38 6.65002H5.38C6.78 6.65002 7.38 7.15002 7.38 8.55002V18.35C7.38 19.75 6.78 20.25 5.38 20.25H4.38C2.98 20.25 2.38 19.75 2.38 18.35Z"
                            stroke="#292D32" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
                    </svg>
                </button>
        </div>
        <div class="hover:bg-gray-200 rounded-xl">
            <svg width="40px" height="40px" viewBox="0 -0.5 25 25" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path fill-rule="evenodd" clip-rule="evenodd"
                    d="M5.5 12C5.49988 14.613 6.95512 17.0085 9.2741 18.2127C11.5931 19.4169 14.3897 19.2292 16.527 17.726L19.5 18V12C19.5 8.13401 16.366 5 12.5 5C8.63401 5 5.5 8.13401 5.5 12Z"
                    stroke="#000000" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
                <path
                    d="M9.5 13.25C9.08579 13.25 8.75 13.5858 8.75 14C8.75 14.4142 9.08579 14.75 9.5 14.75V13.25ZM13.5 14.75C13.9142 14.75 14.25 14.4142 14.25 14C14.25 13.5858 13.9142 13.25 13.5 13.25V14.75ZM9.5 10.25C9.08579 10.25 8.75 10.5858 8.75 11C8.75 11.4142 9.08579 11.75 9.5 11.75V10.25ZM15.5 11.75C15.9142 11.75 16.25 11.4142 16.25 11C16.25 10.5858 15.9142 10.25 15.5 10.25V11.75ZM9.5 14.75H13.5V13.25H9.5V14.75ZM9.5 11.75H15.5V10.25H9.5V11.75Z"
                    fill="#000000" />
            </svg>
        </div>
        <div class="hover:bg-gray-200 rounded-xl">
            <svg width="40px" height="40px" viewBox="0 0 24 24" id="share" xmlns="http://www.w3.org/2000/svg">
                <rect id="Rectangle_3" data-name="Rectangle 3" width="24" height="24" fill="none" />
                <path id="Rectangle" d="M12,4V0l8,7-8,7V10S0,9.069,0,14.737C0,3.4,12,4,12,4Z" transform="translate(2 5)"
                    fill="none" stroke="#000000" stroke-miterlimit="10" stroke-width="1.5" />
            </svg>
        </div>
    </div>
</div>
<%post.comments.forEach((comment)=>{%>
    <div class="post m-4 flex rounded-md">
        <div class="hidden w-full flex bg-white fixed flex-col gap-5 p-4 bottom-0 right-0 z-50">
            <%if(locals.user.id == comment.userId._id){%>
                <button class="flex items-center" onclick="editComment(this,'<%=encodeURIComponent(comment._id)%>','<%=comment.comment%>')">
                    <div class="border-2 border-blue-300 rounded-md ml-3 p-2">
                        <svg width="20px" height="20px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <g id="Edit / Edit_Pencil_02">
                                <path id="Vector"
                                    d="M4 16.0001V20.0001L8 20.0001L18.8686 9.13146L18.8695 9.13061C19.265 8.73516 19.4628 8.53736 19.5369 8.3092C19.6021 8.10835 19.6022 7.89201 19.5369 7.69117C19.4627 7.46284 19.2646 7.26474 18.8686 6.86872L17.1288 5.12892C16.7345 4.7346 16.5369 4.53704 16.3091 4.46301C16.1082 4.39775 15.8919 4.39775 15.691 4.46301C15.463 4.53709 15.2652 4.73488 14.8704 5.12976L14.8686 5.13146L4 16.0001Z"
                                    stroke="#000000" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                            </g>
                        </svg>
                    </div>
                    <span>تعديل التعليق</span>
                </button>
            <%}%>
            <button class="flex items-center">
                <div class="border-2 border-blue-300 rounded-md ml-3 p-2">
                    <svg width="20px" height="20px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path
                            d="M9 11H15M12 8V14M21 20L17.6757 18.3378C17.4237 18.2118 17.2977 18.1488 17.1656 18.1044C17.0484 18.065 16.9277 18.0365 16.8052 18.0193C16.6672 18 16.5263 18 16.2446 18H6.2C5.07989 18 4.51984 18 4.09202 17.782C3.71569 17.5903 3.40973 17.2843 3.21799 16.908C3 16.4802 3 15.9201 3 14.8V7.2C3 6.07989 3 5.51984 3.21799 5.09202C3.40973 4.71569 3.71569 4.40973 4.09202 4.21799C4.51984 4 5.0799 4 6.2 4H17.8C18.9201 4 19.4802 4 19.908 4.21799C20.2843 4.40973 20.5903 4.71569 20.782 5.09202C21 5.51984 21 6.0799 21 7.2V20Z"
                            stroke="#000000" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                    </svg>
                </div>
                <span>إضافة رد</span>
            </button>
            <%if(locals.user.id != comment.userId._id){%>
                <a class="flex items-center" href="/post/comment/report/<%=comment._id%>">
                    <div class="border-2 border-blue-300 rounded-md ml-3 p-2">
                        <svg fill="#000000" width="20px" height="20px" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path fill-rule="evenodd"
                                d="M3.25 4a.25.25 0 00-.25.25v12.5c0 .138.112.25.25.25h2.5a.75.75 0 01.75.75v3.19l3.427-3.427A1.75 1.75 0 0111.164 17h9.586a.25.25 0 00.25-.25V4.25a.25.25 0 00-.25-.25H3.25zm-1.75.25c0-.966.784-1.75 1.75-1.75h17.5c.966 0 1.75.784 1.75 1.75v12.5a1.75 1.75 0 01-1.75 1.75h-9.586a.25.25 0 00-.177.073l-3.5 3.5A1.457 1.457 0 015 21.043V18.5H3.25a1.75 1.75 0 01-1.75-1.75V4.25zM12 6a.75.75 0 01.75.75v4a.75.75 0 01-1.5 0v-4A.75.75 0 0112 6zm0 9a1 1 0 100-2 1 1 0 000 2z" />
                        </svg>
                    </div>
                    <span>إبلاغ</span>
                </a>
            <%}%>
            <%if(locals.user.id == comment.userId._id){%>
                <form action="/post/delComment" method="post">
                    <input type="hidden" name="commentId" value="<%=comment._id%>">
                    <button class="flex items-center w-full">
                        <div class="border-2 border-blue-300 rounded-md ml-3 p-2">
                            <svg width="20px" height="20px" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg">
                                <path fill="#000000"
                                    d="M160 256H96a32 32 0 0 1 0-64h256V95.936a32 32 0 0 1 32-32h256a32 32 0 0 1 32 32V192h256a32 32 0 1 1 0 64h-64v672a32 32 0 0 1-32 32H192a32 32 0 0 1-32-32V256zm448-64v-64H416v64h192zM224 896h576V256H224v640zm192-128a32 32 0 0 1-32-32V416a32 32 0 0 1 64 0v320a32 32 0 0 1-32 32zm192 0a32 32 0 0 1-32-32V416a32 32 0 0 1 64 0v320a32 32 0 0 1-32 32z" />
                            </svg>
                        </div>
                        <span>حذف التعليق</span>
                    </button>
                </form>
            <%}%>
        </div>
        <img class="h-12 border w-12 rounded-full object-cover"
            src="<%=comment.userId.avatar.replace('uploads','')%>" alt="comment-user">
        <div class="p-2 bg-gray-200 rounded-xl">
            <h1><%=comment.userId.name%></h1>
            <p style="line-break: anywhere;">
               <%=comment.comment%>
            </p>
        </div>
    </div>
<%})%>
<div class="h-20"></div>
<div class="fixed flex items-center bottom-0 right-0 w-full bg-white">
    <form class="flex w-full items-center" action="/post/addComment" method="post">
        <input type="hidden" name="postId" value="<%=post._id%>">
        <textarea rows="1" class="flex w-full p-2 m-4 bg-slate-200 rounded-xl outline-none resize-none overflow-hidden"
            name="comment" id="comment" placeholder="إكتب تعليق..."></textarea>
        <button class="flex items-center justify-center border rounded-xl w-12 h-10 ml-2 hover:bg-slate-200">
            <svg width="30px" height="30px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path
                    d="M10.3009 13.6949L20.102 3.89742M10.5795 14.1355L12.8019 18.5804C13.339 19.6545 13.6075 20.1916 13.9458 20.3356C14.2394 20.4606 14.575 20.4379 14.8492 20.2747C15.1651 20.0866 15.3591 19.5183 15.7472 18.3818L19.9463 6.08434C20.2845 5.09409 20.4535 4.59896 20.3378 4.27142C20.2371 3.98648 20.013 3.76234 19.7281 3.66167C19.4005 3.54595 18.9054 3.71502 17.9151 4.05315L5.61763 8.2523C4.48114 8.64037 3.91289 8.83441 3.72478 9.15032C3.56153 9.42447 3.53891 9.76007 3.66389 10.0536C3.80791 10.3919 4.34498 10.6605 5.41912 11.1975L9.86397 13.42C10.041 13.5085 10.1295 13.5527 10.2061 13.6118C10.2742 13.6643 10.3352 13.7253 10.3876 13.7933C10.4468 13.87 10.491 13.9585 10.5795 14.1355Z"
                    stroke="#000000" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
            </svg>
        </button>
    </form>
</div>
<script src="/filepond/dist/filepond.js"></script>
<script src="/filepond-plugin-media-preview/dist/filepond-plugin-media-preview.js"></script>
<script src="/filepond-plugin-file-validate-size/dist/filepond-plugin-file-validate-size.js"></script>
<script src="/filepond-plugin-image-edit/dist/filepond-plugin-image-edit.js"></script>
<script src="/filepond-plugin-image-exif-orientation/dist/filepond-plugin-image-exif-orientation.js"></script>
<script src="/filepond-plugin-image-preview/dist/filepond-plugin-image-preview.js"></script>
<script src="/filepond-plugin-file-validate-type/dist/filepond-plugin-file-validate-type.js"></script>
<script src="/filepond-plugin-image-crop/dist/filepond-plugin-image-crop.js"></script>
<script src="/filepond-plugin-image-resize/dist/filepond-plugin-image-resize.js"></script>
<script src="/filepond-plugin-image-transform/dist/filepond-plugin-image-transform.js"></script>
<!-- video show -->
<script src="/filepond-plugin-video-preview/dist/filepond-plugin-video-preview.js"></script>
<!-- public js -->
 <script src="/axios/dist/axios.js"></script>
<script src="/js/post.js"></script>